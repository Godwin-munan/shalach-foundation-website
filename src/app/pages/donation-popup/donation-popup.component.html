<div class="donation-popup-overlay" (click)="close()">
  <div class="donation-popup-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="close()" aria-label="Close">&times;</button>

    <!-- Success State -->
    <div *ngIf="showSuccess" class="success-message">
      <div class="success-icon">âœ“</div>
      <h3>Thank you for your donation!</h3>
      <p>{{ successMessage }}</p>
      <button class="btn btn-primary" (click)="resetAndClose()">Close</button>
    </div>

    <!-- Donation Form -->
    <div *ngIf="!showSuccess && !loading">
      <h2>Support Our Cause</h2>
      <p class="subtitle">Every contribution helps us make a difference</p>

      <form [formGroup]="donationForm" (ngSubmit)="submitDonation()">

        <!-- Suggested Amounts -->
        <!-- <div class="amount-section">
          <h4>Select Amount</h4>
          <div class="suggested-amounts">
            <button
              *ngFor="let amount of suggestedAmounts"
              type="button"
              class="amount-btn"
              [class.selected]="selectedAmount === amount"
              (click)="selectAmount(amount)"
            >
              {{ formatAmount(amount) }}
            </button>
          </div>
        </div> -->

        <!-- Custom Amount Input -->
        <div class="form-group">
          <label for="amount">Enter Amount (â‚¦)</label>
          <input
            id="amount"
            type="text"
            inputmode="numeric"
            pattern="[0-9]*"
            class="form-control"
            [value]="amountDisplay"
            (input)="onCustomAmountChangeV2($event)"
            (keypress)="onAmountKeyPress($event)"
            placeholder="Enter amount (min â‚¦100)"
            [class.is-invalid]="isAmountInvalid"
            autocomplete="off"
          />
          <div *ngIf="isAmountInvalid" class="invalid-feedback">
            <span *ngIf="f['amount'].errors?.['required']">Amount is required</span>
            <span *ngIf="f['amount'].errors?.['min']">Minimum amount is â‚¦100</span>
            <span *ngIf="f['amount'].errors?.['max']">Maximum amount is â‚¦10,000,000</span>
          </div>
          <!-- <small class="form-text text-muted" *ngIf="f['amount'].value">
            Amount: â‚¦{{ formatNumberWithCommas(f['amount'].value) }}
          </small> -->
        </div>

        <!-- Donor Information -->
        <div class="form-group">
          <label for="donor_name">Full Name *</label>
          <input
            id="donor_name"
            type="text"
            class="form-control"
            formControlName="donor_name"
            placeholder="John Doe"
            [class.is-invalid]="isDonorNameInvalid"
          />
          <div *ngIf="isDonorNameInvalid" class="invalid-feedback">
            <span *ngIf="f['donor_name'].errors?.['required']">Name is required</span>
            <span *ngIf="f['donor_name'].errors?.['minlength']">Name must be at least 3 characters</span>
          </div>
        </div>

        <div class="form-group">
          <label for="donor_email">Email Address *</label>
          <input
            id="donor_email"
            type="email"
            class="form-control"
            formControlName="donor_email"
            placeholder="john@example.com"
            [class.is-invalid]="isDonorEmailInvalid"
          />
          <div *ngIf="isDonorEmailInvalid" class="invalid-feedback">
            <span *ngIf="f['donor_email'].errors?.['required']">Email is required</span>
            <span *ngIf="f['donor_email'].errors?.['email']">Please enter a valid email</span>
          </div>
        </div>

        <div class="form-group">
          <label for="donor_phone">Phone Number (Optional)</label>
          <input
            id="donor_phone"
            type="tel"
            class="form-control"
            formControlName="donor_phone"
            placeholder="+234 800 000 0000"
            [class.is-invalid]="f['donor_phone'].invalid && f['donor_phone'].touched"
          />
          <div *ngIf="f['donor_phone'].invalid && f['donor_phone'].touched" class="invalid-feedback">
            Please enter a valid phone number (10-15 digits)
          </div>
        </div>

        <!-- Purpose (Optional) -->
        <div class="form-group">
          <label for="purpose">Purpose (Optional)</label>
          <input
            id="purpose"
            type="text"
            class="form-control"
            formControlName="purpose"
            placeholder="What should we use this donation for?"
          />
        </div>

        <!-- Anonymous Donation -->
        <div class="form-check">
          <input
            id="is_anonymous"
            type="checkbox"
            class="form-check-input"
            formControlName="is_anonymous"
          />
          <label for="is_anonymous" class="form-check-label">
            Make this an anonymous donation
          </label>
        </div>

        <!-- Payment Method Selection -->
        <div class="payment-methods">
          <h4>Payment Method</h4>
          <div class="payment-options">
            <label class="payment-option">
              <input
                type="radio"
                formControlName="payment_method"
                value="online"
              />
              <span class="payment-label">
                <i class="icon-card"></i>
                Online Payment (Card, Bank Transfer, USSD)
              </span>
            </label>
            <label class="payment-option">
              <input
                type="radio"
                formControlName="payment_method"
                value="bank-transfer"
              />
              <span class="payment-label">
                <i class="icon-bank"></i>
                Direct Bank Transfer
              </span>
            </label>
          </div>
        </div>

        <!-- Bank Details (if bank transfer selected) -->
        <div *ngIf="showBankDetails" class="bank-details-container">
          <h4>Bank Transfer Details</h4>
          <p class="bank-info-text">
            Please transfer to one of the accounts below and we'll confirm your donation.
          </p>
          <div *ngFor="let account of bankAccounts" class="bank-details">
            <p class="account-type">{{ account.accountType }}</p>
            <div class="account-info">
              <p><strong>Bank:</strong> {{ account.bankName }}</p>
              <p><strong>Account Name:</strong> {{ account.accountName }}</p>
              <p class="account-number">
                <strong>Account Number:</strong>
                <span>{{ account.accountNumber }}</span>
                <button
                  type="button"
                  class="copy-btn"
                  (click)="copyToClipboard(account.accountNumber)"
                  title="Copy account number"
                >
                  ðŸ“‹
                </button>
              </p>
            </div>
          </div>
        </div>

        <!-- Error Message -->
        <div *ngIf="error" class="alert alert-danger">
          {{ error }}
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="btn btn-primary btn-block"
          [disabled]="!isFormValid() || loading"
        >
          <span *ngIf="!loading">
            {{ f['payment_method'].value === 'online' ? 'Proceed to Payment' : 'Submit Donation' }}
          </span>
          <span *ngIf="loading">Processing...</span>
        </button>

        <p class="security-note">
          <i class="icon-lock"></i>
          Your payment is secure and encrypted
        </p>
      </form>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="spinner"></div>
      <p>Initializing payment, please wait...</p>
    </div>
  </div>
</div>
